import{Q as _}from"./QBtn.7faca946.js";import{Q as V}from"./QTable.3af2fecc.js";import{c as B,b as h}from"./render.bb05bb94.js";import{c as D,h as Q,g as U,a0 as j,O as C,al as v,aa as g,n as q,a1 as F,z as d,d as t,q as s,F as P,t as k,v as y,a8 as z,B as T,p as A,av as N,aw as R}from"./index.739fefb5.js";import{Q as I}from"./Ripple.b8857d57.js";import{Q as H,a as b}from"./QForm.440978a6.js";import{d as M,b as O,Q as W}from"./QCheckbox.75ad47f0.js";import{Q as $,C as E}from"./ClosePopup.c6b0871e.js";import{Q as G}from"./QCardActions.40446109.js";import{Q as J}from"./QCard.2dc9918d.js";import"./QSpinner.adb6de04.js";import"./use-size.20ba4e13.js";import"./use-dark.51c8344e.js";import"./scroll.cc691cd4.js";import"./use-fullscreen.1c541a60.js";import"./use-key-composition.e8bfb011.js";import"./uid.42677368.js";var w=B({name:"QTd",props:{props:Object,autoWidth:Boolean,noHover:Boolean},setup(r,{slots:m}){const u=U(),i=D(()=>"q-td"+(r.autoWidth===!0?" q-table--col-auto-width":"")+(r.noHover===!0?" q-td--no-hover":"")+" ");return()=>{if(r.props===void 0)return Q("td",{class:i.value},h(m.default));const e=u.vnode.key,p=(r.props.colsMap!==void 0?r.props.colsMap[e]:null)||r.props.col;if(p===void 0)return;const{row:f}=r.props;return Q("td",{class:i.value+p.__tdClass(f),style:p.__tdStyle(f)},h(m.default))}}});const S=r=>(N("data-v-a2cfb158"),r=r(),R(),r),K={id:"admin-products"},L=S(()=>d("h2",{class:"title"},"\u5546\u54C1\u7BA1\u7406",-1)),X={class:"row"},Y={class:"col-10 mb-lg"},Z={class:"col-10"},ee=["src"],oe={class:"text-center"},le={class:"row"},te={class:"col-12"},ae={class:"col-12"},se={class:"col-12"},de={class:"col-12"},ie={class:"col-12"},re={class:"col-12"},ne=S(()=>d("div",{class:"col-12"},null,-1)),ce={__name:"ProductsView",setup(r){const m=["\u66F8","\u660E\u4FE1\u7247","\u5176\u4ED6"],u={required(o){return!!o||"\u6B04\u4F4D\u5FC5\u586B"},price(o){return o>=0||"\u50F9\u683C\u932F\u8AA4"}},i=C([]),e=C({_id:"",name:"",price:0,description:"",image:void 0,sell:!1,category:"",loading:!1,dialog:!1,idx:-1}),p=o=>{o===-1?(e._id="",e.name="",e.price=0,e.description="",e.image=void 0,e.sell=!1,e.category="",e.loading=!1,e.idx=-1):(e._id=i[o]._id,e.name=i[o].name,e.price=i[o].price,e.description=i[o].description,e.image=void 0,e.sell=i[o].sell,e.category=i[o].category,e.loading=!1,e.idx=o),e.dialog=!0},f=async()=>{var l,n;e.loading=!0;const o=new FormData;o.append("name",e.name),o.append("price",e.price),o.append("description",e.description),o.append("image",e.image),o.append("sell",e.sell),o.append("category",e.category);try{if(e._id.length===0){const{data:c}=await v.post("/products",o);i.push(c.result),g.fire({icon:"success",title:"\u6210\u529F",text:"\u65B0\u589E\u6210\u529F"})}else{const{data:c}=await v.patch("/products/"+e._id,o);i[e.idx]=c.result,g.fire({icon:"success",title:"\u6210\u529F",text:"\u7DE8\u8F2F\u6210\u529F"})}e.dialog=!1}catch(c){g.fire({icon:"error",title:"\u5931\u6557",text:((n=(l=c==null?void 0:c.response)==null?void 0:l.data)==null?void 0:n.message)||"\u767C\u751F\u932F\u8AA4"})}e.loading=!1};return(async()=>{var o,l;try{const{data:n}=await v.get("/products/all");i.push(...n.result)}catch(n){g.fire({icon:"error",title:"\u5931\u6557",text:((l=(o=n==null?void 0:n.response)==null?void 0:o.data)==null?void 0:l.message)||"\u767C\u751F\u932F\u8AA4"})}})(),(o,l)=>{const n=k("q-card-title"),c=k("q-card-text");return q(),F(P,null,[d("div",K,[L,d("div",X,[d("div",Y,[t(_,{color:"primary",onClick:l[0]||(l[0]=a=>p(-1))},{default:s(()=>[y("\u65B0\u589E\u5546\u54C1")]),_:1})]),d("div",Z,[t(V,{rows:i,columns:o.columns},null,8,["rows","columns"])]),t(V,{rows:o.filterData,columns:o.columns,"row-key":"_id"},{"body-cell-image":s(a=>[t(w,null,{default:s(()=>[d("img",{src:a.row.image,style:{height:"100px"}},null,8,ee)]),_:2},1024)]),"body-cell-sell":s(a=>[t(w,null,{default:s(()=>[t(I,{class:"btn-size",name:a.row.sell?"fa-solid fa-face-smile":"fa-solid fa-face-dizzy"},null,8,["name"])]),_:2},1024)]),"body-cell-edit":s(a=>[t(w,null,{default:s(()=>[t(_,{round:"round",onClick:ue=>o.openAdd(o.filterData.findIndex(x=>x._id===a.row._id)),icon:"fa-solid fa-pen-to-square"},null,8,["onClick"])]),_:2},1024)]),_:1},8,["rows","columns"])])]),t(M,{modelValue:e.dialog,"onUpdate:modelValue":l[7]||(l[7]=a=>e.dialog=a),persistent:""},{default:s(()=>[t(J,null,{default:s(()=>[t(H,{onSubmit:f},{default:s(()=>[t(n,null,{default:s(()=>[d("h3",oe,z(e._id.length>0?"\u7DE8\u8F2F\u5546\u54C1":"\u65B0\u589E\u5546\u54C1"),1)]),_:1}),t(c,null,{default:s(()=>[d("div",le,[d("div",te,[t(b,{modelValue:e.name,"onUpdate:modelValue":l[1]||(l[1]=a=>e.name=a),type:"text",label:"\u540D\u7A31",rules:[u.required]},null,8,["modelValue","rules"])]),d("div",ae,[t(b,{modelValue:e.price,"onUpdate:modelValue":l[2]||(l[2]=a=>e.price=a),type:"number",label:"\u50F9\u683C",rules:[u.required,u.price]},null,8,["modelValue","rules"])]),d("div",se,[t(b,{modelValue:e.description,"onUpdate:modelValue":l[3]||(l[3]=a=>e.description=a),rows:"3","auto-grow":"auto-grow",label:"\u8AAA\u660E",rules:[u.required]},null,8,["modelValue","rules"])]),d("div",de,[t(O,{modelValue:e.category,"onUpdate:modelValue":l[4]||(l[4]=a=>e.category=a),options:m,rules:[u.required],label:"\u7A2E\u985E"},null,8,["modelValue","rules"])]),d("div",ie,[t($,{modelValue:e.image,"onUpdate:modelValue":l[5]||(l[5]=a=>e.image=a),label:"Pick Images",filled:"",append:"",accept:".jpg, image/*",onRejected:o.onRejected},{prepend:s(()=>[t(I,{name:"image"})]),_:1},8,["modelValue","onRejected"])]),d("div",re,[t(W,{modelValue:e.sell,"onUpdate:modelValue":l[6]||(l[6]=a=>e.sell=a),label:"\u4E0A\u67B6"},null,8,["modelValue"])]),ne])]),_:1}),t(G,null,{default:s(()=>[T((q(),A(_,{disabled:e.loading,cocolor:"primary"},{default:s(()=>[y("\u53D6\u6D88")]),_:1},8,["disabled"])),[[E]]),t(_,{disabled:e.loading,color:"primary",type:"submit"},{default:s(()=>[y("\u9001\u51FA")]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64)}}};var xe=j(ce,[["__scopeId","data-v-a2cfb158"]]);export{xe as default};
